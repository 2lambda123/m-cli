#!/usr/bin/env bash
# Reference: Script Editor.app > Window > Library

help () {
    cat<<__EOF__
    usage: m itunes <option>

    Option:
      status                     # Show status
      state                      # Get player state
      progress                   # Get current progress of song (in sec)
      play                       # Play track
      pause                      # Pause track
      next                       # Play next track
      prev                       # Play previous track
      mute                       # Mute iTunes
      unmute                     # Unmute iTunes
      repeat                     # Get repeat state
      repeat [ one | all | off ] # Set repeat mode to one/all/off
      shuffle                    # Toggles shuffle
      vol up                     # Volume Up
      vol down                   # Volume Down
      vol #                      # Set volume level
      stop                       # Stop track
      quit                       # Quit iTunes

    Example:
      m itunes status
__EOF__
}

case $1 in
    help)
        help
        ;;
    status)
        state=`osascript -e 'tell application "iTunes" to player state as string'`
        echo "iTunes is currently $state."
        if [ $state = "playing" ]; then
            artist=`osascript -e 'tell application "iTunes" to artist of current track as string'`
            track=`osascript -e 'tell application "iTunes" to name of current track as string'`
            echo "Current track $artist:  $track"
        fi
        ;;
    state)
        state=`osascript -e 'tell application "iTunes" to player state as string'`
        echo "$state"
        ;;
    progress)
        actualProg=$(osascript -e 'tell application "iTunes" to get player position')
        echo "$actualProg" | cut -d. -f1
        ;;
    play)
        osascript -e 'tell application "iTunes" to play'
        ;;
    pause)
        osascript -e 'tell application "iTunes" to pause'
        ;;
    next)
        osascript -e 'tell application "iTunes" to next track'
        ;;
    prev)
        osascript -e 'tell application "iTunes" to previous track'
        ;;
    mute)
        osascript -e 'tell application "iTunes" to set mute to true'
        ;;
    unmute)
        osascript -e 'tell application "iTunes" to set mute to false'
        ;;
    repeat)
        if [ "$2" = "" ]; then
          osascript -e 'tell application "iTunes" to song repeat'
        elif [ ! "$2" = "one" ] && [ ! "$2" = "all" ] && [ ! "$2" = "off" ]; then
          echo "usage: m itunes repeat [ one | all | off ]"
          exit 1
        elif [ "$2" = "one" ]; then
          osascript -e 'tell application "iTunes" to set song repeat to one'
        elif [ "$2" = "all" ]; then
          osascript -e 'tell application "iTunes" to set song repeat to all'
        elif [ "$2" = "off" ]; then
          osascript -e 'tell application "iTunes" to set song repeat to off'
        fi
        ;;
    shuffle)
        if [ "$(osascript -e 'tell application \"iTunes\" to get shuffle enabled')" = "true" ]; then
          osascript -e 'tell application "iTunes" to set shuffle enabled to false'
        else
          osascript -e 'tell application "iTunes" to set shuffle enabled to true'
        fi 
        ;;
    vol)
        vol=`osascript -e 'tell application "iTunes" to sound volume as integer'`

        case "$2" in
            up)
                newvol=$(( vol+10 ))    ;;
            down)
                newvol=$(( vol-10 ))    ;;
            [0-9]*)
                newvol=$2               ;;
            *)
                help  && exit 1         ;;
        esac
        osascript -e "tell application \"iTunes\" to set sound volume to $newvol"
        ;;
    stop)
        osascript -e 'tell application "iTunes" to stop'
        ;;
    quit)
        osascript -e 'tell application "iTunes" to quit'
        ;;
    *)
        help
        ;;
esac
